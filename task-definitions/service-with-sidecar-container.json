[
  {
    "cpu":${cpu},
    "image":"${service_image}",
    "memory":${memory},
    "name":"${service_name}",
    "networkmode":"awsvpc",
    "essential":true,
    "logconfiguration":{
      "logdriver":"awslogs",
      "options":{
        "awslogs-group":"${log_group_name}",
        "awslogs-region":"${region}",
        "awslogs-stream-prefix":"${service_name}"
      }
    },
    "portmappings":[
      {
        "containerport":${service_port},
        "hostport":${service_port}
      }
    ],
    "environment" : ${envvars},
    "secrets" : ${secrets_task_definition},
%{ if attach_lb == false }
    "healthCheck": {
        "command": ${health_check_command},
        "interval": ${health_check_interval},
        "timeout": ${health_check_timeout}
    }
%{ endif }
  },
  {
    "cpu":${apm_cpu},
    "image":"${apm_sidecar_ecr_url}",
    "memory":${apm_memory},
    "name":"${apm_name}",
    "networkmode":"awsvpc",
    "essential":true,
    "logconfiguration": {
      "logdriver": "awslogs",
      "options":{
        "awslogs-group":"${log_group_name}",
        "awslogs-region":"${region}",
        "awslogs-stream-prefix":"${apm_name}"
      }
    },
    "portmappings": [
      {
        "protocol": "udp",
        "containerport":${apm_service_port},
        "hostport":${apm_service_port}
      }
    ],
    "volumesfrom": []
  }
]
